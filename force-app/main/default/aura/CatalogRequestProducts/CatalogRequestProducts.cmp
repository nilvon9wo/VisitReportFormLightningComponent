<aura:component controller="Lightning_CatalogRequestProducts" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickAction" access="global" >
	<aura:attribute name="recordId" type="String"/>
    <aura:attribute name="pricebookId" type="String"/>
    <aura:attribute name="columns" type="List"/>  
    <aura:attribute name="lineItems" type="List"/>
    <aura:attribute name="draftValues" type="Object" default="[]"/>
    <aura:attribute name="showingAddProducts" type="Boolean" default="false"/>
    <aura:attribute name="showSpinner" type="Boolean" default="false"/>
     <aura:handler name="ProductsAddedEvt" event="c:ProductsAddedEvt" action="{!c.handleProductsAdded}"/>
    <aura:handler name="init" value="{!this }" action="{!c.doInit }"/>  
    
    <aura:if isTrue="{!v.showSpinner}">
        <lightning:spinner />
    </aura:if>
    
    <div class="slds-m-left_small" style="width:20%">
    <lightning:recordEditForm recordId="{!v.recordId}" 
                              objectApiName="Catalog_Request__c" 
                              onload="{!c.handleLoad}">
                <lightning:inputfield fieldName="Price_Book__c" class="slds-hide"/>
    </lightning:recordEditForm>
    </div>
    
    <div class="slds-grid--vertical slds-m-around_small slds-p-bottom_small slds-box">
        <div class="slds-col slds-size_1-of-2 slds-m-bottom_small" style="text-align:right;">
            <lightning:button label="Add Products" title="Add Products" onclick="{!c.showAddProducts}"/>
        </div>    
        <div style="min-height:275px;overflow-y:scroll;">
            <lightning:datatable 
                                 keyField="Id"           
                                 data="{! v.lineItems }"
                                 columns="{! v.columns }"
                                 onrowaction="{! c.handleRowAction }"
                                 draftValues="{!v.draftValues}"
                                 errors = "{!v.errors}"
                                 onsave = "{!c.handleTableUpdates}"
                                 hideCheckboxColumn="true"/> 
        </div>
    </div>
    
    <aura:if isTrue="{!v.showingAddProducts}">
            <div aura:id="productsModal"  class="slds-modal slds-fade-in-open hideDiv" aria-hidden="false" role="dialog">
                    <div class="slds-modal__container" style="max-width:90rem;">
                        <div class="slds-modal__header">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="{!c.hideAddProducts}">
                                <lightning:icon iconName="utility:close" size="medium" variant="bare"/>
                                <span class="slds-assistive-text">Close</span>
                            </button>
                            <h2 class="slds-text-heading--medium">Add Products</h2>
                        </div>
                        <div class="slds-modal__content slds-p-around--medium" style="min-height:500px;">
                            <div class="modalContent">
                                <c:AddProductsToCatalogRequest recordId="{!v.recordId}" aura:id="child"/>
                            </div>
                        </div>
                        <div class="slds-modal__footer">
                             <button class="slds-button slds-button--neutral slds-button--brand" onclick="{!c.onCallChildMethod}">Select Products</button>
                            <button class="slds-button slds-button--neutral slds-button--brand" onclick="{!c.hideAddProducts}">Close</button>
                        </div>
                    </div>
             </div>    
    		<div class="slds-backdrop slds-backdrop--open" id="backdrop"></div>
    </aura:if>
    
</aura:component>